(function BtgTracking() { var endpointProduct = "https:function BtgSend(btgId,event,data,categories,pedido){var sendData;if (event === "email" || event === "client"){sendData = [{email:data}];}else if (event === "cart" || event === "product"){var cats = categories && categories.productCategories || [];sendData = [{id:data.productId,name:data.productName,price:data.prices.priceTables[0].price,department:cats[0] ? cats[0].name:"",category:cats[1] ? cats[1].name:"",subCategory:cats[2] ? cats[2].name:"",brand:data.productBrand.name}];}else if (event === "transaction"){var cats = categories && categories.productCategories || [];sendData = [{transactionId:pedido.pedidoInfo.Id,id:data.productId,name:data.productName,price:data.prices.priceTables[0].price,department:cats[0] ? cats[0].name:"",category:cats[1] ? cats[1].name:"",subCategory:cats[2] ? cats[2].name:"",brand:data.productBrand.name}];}if (sendData){if (window.Btg360 && typeof Btg360.add === "function"){Btg360.add({account:btgId,event:event,domain:window.location.hostname,items:sendData});}}else{console.warn("BtgSend:evento não reconhecido ou dados incompletos",event);}}function getClient(){return new Promise(function (resolve,reject){var url;if (window.location.hostname.indexOf("checkout") === -1){var formatUrl = window.location.hostname.split(".");formatUrl.shift();formatUrl = formatUrl.join(".");url = "https:}else { url = "https:}fetch(url,{method:"GET",headers:{"Accept":"application / json"},credentials:"include"}).then(function (response){return response.json();}).then(resolve).catch(reject);});}function getProduct(productId,tcsToken){var graphQuery = "query Query{ " + "products(first: 50, filters: { productId: " + parseInt(productId,10) + " }){ " + " edges{node{ " + " productId productName productBrand{ name } " + " productCategories{ name } " + " prices{priceTables{ price } } " + " } } } } ";return new Promise(function (resolve,reject){fetch(endpointProduct,{method:"POST",headers:{"Content - Type":"application / json","Accept":"application / json","TCS - Access - Token":tcsToken},body:JSON.stringify({query:graphQuery})}).then(function (response){if (!response.ok) return reject(new Error("Erro HTTP: " + response.status));return response.json();}).then(function (data){if (data && data.data && data.data.products && data.data.products.edges.length > 0){resolve(data.data.products.edges[0].node);}else{reject(new Error("Produto não encontrado na resposta"));}}).catch(reject);});}function getCartProducts(){var endpointCart = "https: return fetch(endpointCart, { method: "GET", headers: { "Accept": "application/json" }, credentials: "include" }).then(function (res) { return res.json(); }); } function getTransactionProducts() { var endpointCart = "https:return fetch(endpointCart,{method:"GET",headers:{"Accept":"application / json"},credentials:"include"}).then(function (res){return res.json();}).then(function (data){return{produtos:data.Produtos,pedidoInfo:data.Pedidos};});}this.start = function (btgId,tcsToken){getClient().then(function (data){var email = data && data.Email ? data.Email:"";BtgSend(btgId,"client",email,null,null);}).catch(function (error){console.error("Erro ao buscar cliente: ",error);});var host = window.location.hostname;var path = window.location.pathname;if (host.indexOf("checkout") !== -1){if (path === " / "){getCartProducts().then(function (data){if (!data || !data.Produtos) return;data.Produtos.forEach(function (item){getProduct(item.ProdutoId,tcsToken).then(function (produto){BtgSend(btgId,"cart",produto,{productCategories:produto.productCategories},null);}).catch(function (error){console.error("Erro ao buscar produto no carrinho: ",error);});});}).catch(function (error){console.error("Erro ao buscar produtos do carrinho: ",error);});}else if (path === " / Confirmacao"){getTransactionProducts().then(function (data){if (!data || !data.produtos) return;data.produtos.forEach(function (item){getProduct(item.ProdutoId,tcsToken).then(function (produto){BtgSend(btgId,"transaction",produto,{productCategories:produto.productCategories},{pedidoInfo:data.pedidoInfo});}).catch(function (error){console.error("Erro ao buscar produto na transação: ",error);});});}).catch(function (error){console.error("Erro ao buscar dados da transação: ",error);});}}if (path.indexOf(" / produto / ") !== -1){var pathSplit = path.split(" - ");var productId = pathSplit[pathSplit.length - 1];getProduct(productId,tcsToken).then(function (produto){BtgSend(btgId,"product",produto,{productCategories:produto.productCategories},null);}).catch(function (error){console.error("Erro ao obter produto: ",error);});}};window.BtgTracking = this;})();